#!/bin/bash
# @author: Gia Tuấn
# @website: https://wptangtoc.com
# @email: giatuan@wptangtoc.com
# @since: 2022

. /etc/wptt/echo-color
function help() {
    . /etc/wptt/.wptt.conf
    echo "-------------------------------------------------------------------------"
    echo "Gọi Menu WPTangToc OLS ấn phím 1 hoặc wptangtoc"
    echo "Cập nhật WPTangToc OLS ấn phím 99 hoặc wptt update-wptangtoc"
    echo "-------------------------------------------------------------------------"
    echo "Một số câu lệnh sử dụng WPTangToc OLS không cần truy cập Menu WPTangToc OLS"
    echo "Sao lưu tất cả website    : wptt saoluu-all"
    echo "Sao lưu website           : wptt saoluu $Website_chinh"
    echo "Khoi phuc website         : wptt khoiphuc $Website_chinh"
    echo "reboot ALL service        : wptt reboot-all"
    echo "reboot LiteSpeed          : wptt reboot-ls"
    echo "reboot Database           : wptt reboot-db"
    echo "Xem thong tin tai khoan   : wptt taikhoan"
    echo "Xem cau hinh webserver    : wptt cauhinh"
    echo "Xem dia chi IP cua VPS    : wptt ip"
    echo "Preload Cache ALL         : wptt preload-all"
    echo "Preload Cache             : wptt preload $Website_chinh"
    echo "Xoa Cache ALL             : wptt xoa-cache-all"
    echo "Xoa cache                 : wptt xoa-cache $Website_chinh"
    echo "Phan quyen ALL            : wptt phan-quyen"
    echo "Phan quyen domain         : wptt phan-quyen $Website_chinh"
    echo "Thêm website              : wptt them-website"
    echo "Tinh trang disk 			: wptt disk"
    echo "Kich hoat PhpMyAdmin		: wptt phpmyadmin"
    echo "Huy kich hoat PhpMyAdmin	: wptt xoa-phpmyadmin"
    echo "Truy cập mã nguồn nhanh	: wptt cd"
    echo "Tai khoan PhpMyAdmin		: wptt phpmyadmin-taikhoan"
    echo "Danh sach domain          : wptt list-domain"
    echo "Reset Htaccess            : wptt htaccess-reset"
    echo "Cai SSL FREE letsencrypt  : wptt ssl $Website_chinh"
    echo "Cai ma nguon WordPress    : wptt install-wordpress $Website_chinh"
    echo "Kiem tra domain dns tro ve may chu chua: wptt dns-check $Website_chinh"
    echo "-------------------------------------------------------------------------"
    echo "ghi chu: $Website_chinh bạn có thể thay bằng domain khác có trong hệ thống của bạn để thực thi lệnh"
    echo "-------------------------------------------------------------------------"
    echo "Ghi chu 2: wptt là viết tắt của wptangtoc đơn giản thế thôi, như vậy để câu lệnh dễ nhớ"
    echo "-------------------------------------------------------------------------"
}

function reboot-ls() {
_runing "Khởi động lại LiteSpeed"
/usr/local/lsws/bin/lswsctrl restart >/dev/null 2>&1
_rundone "Khởi động lại LiteSpeed"
    echo "-------------------------------------------------------------------------"
check_active=$(systemctl status lshttpd.service | grep 'Active' | cut -f2 -d':' | xargs | cut -f1 -d' ' | xargs)
	if [[ $check_active = "active" ]];then
    echoDone "Tình trạng hoạt động LiteSpeed hiện tại"
    echoDone "LiteSpeed Webserver     : Hoạt động tốt"
else
    echoDo "Tình trạng hoạt động LiteSpeed hiện tại"
    echoDo "LiteSpeed Webserver     : Đang gặp sự cố"
	fi
    echo "+-----------------------------------------------------------------------+"
}

function reboot-db() {
_runing "Khởi động lại Maria Database"
 systemctl restart mariadb.service
_rundone "Khởi động lại Maria Database"
    echo "-------------------------------------------------------------------------"
    echoDone "Hoàn tất reboot Maria Database"
    echo "-------------------------------------------------------------------------"
check_active=$(systemctl status mariadb.service | grep 'Active' | cut -f2 -d':' | xargs | cut -f1 -d' ' | xargs)
	if [[ $check_active = "active" ]];then
    echoDone "Tình trạng hoạt động Maria Database hiện tại"
    echoDone "Maria Database    : Hoạt động tốt"
else
    echoDone "Tình trạng hoạt động Maria Database hiện tại"
    echoDo "Maria Database     : Đang gặp sự cố"
	fi
    echo "+-----------------------------------------------------------------------+"
}

function reboot-all() {
_runing "Khởi động lại LiteSpeed"
/usr/local/lsws/bin/lswsctrl restart >/dev/null 2>&1
_rundone "Khởi động lại LiteSpeed"

_runing "Khởi động lại Maria Database"
 systemctl restart mariadb.service
_rundone "Khởi động lại Maria Database"

_runing "Khởi động lại SSH"
 systemctl restart sshd.service
_rundone "Khởi động lại SSH"

_runing "Khởi động lại Crond"
 systemctl restart crond.service
_rundone "Khởi động lại Crond"

_runing "Khởi động lại fail2ban"
 systemctl restart fail2ban.service
_rundone "Khởi động lại fail2ban"

if [[ -d /usr/local/lsmcd ]];then
_runing "Khởi động lại LSMemcached"
 systemctl restart lsmcd.service
_rundone "Khởi động lại LSMemcached"
fi

if [[ -f /etc/redis.conf ]];then
_runing "Khởi động lại Redis"
 systemctl restart redis.service
_rundone "Khởi động lại Redis"
fi

if [[ -f /etc/sysconfig/memcached ]];then
_runing "Khởi động lại Memcached"
 systemctl restart memcached.service
_rundone "Khởi động lại Memcached"
fi

if [[ -f /etc/csf/csf.conf ]];then
_runing "Khởi động lại CSF"
 systemctl restart csf.service
 systemctl restart lfd.service
_rundone "Khởi động lại CSF"
fi

    echo "+-----------------------------------------------------------------------+"
    echo "|Tình trạng hoạt động các service hiện tại                              |"
    echo "+-----------------------------------------------------------------------+"
    echo "|LiteSpeed     : $(systemctl status lshttpd.service | grep 'Active' | cut -f2 -d':' | xargs | cut -f1 -d' ' | xargs)                                                  |"
    echo "|MariaDB       : $(systemctl status mariadb.service | grep 'Active' | cut -f2 -d':' | xargs | cut -f1 -d' ' | xargs)                                                 |"
if [[ -f /etc/sysconfig/memcached ]];then
    echo "|Memcached   : $(systemctl status memcached.service | grep 'Active' | cut -f2 -d':' | xargs | cut -f1 -d' ' | xargs)                                                 |"
fi
if [[ -d /usr/local/lsmcd ]];then
    echo "|LSMemcached   : $(systemctl status lsmcd.service | grep 'Active' | cut -f2 -d':' | xargs | cut -f1 -d' ' | xargs)                                                 |"
fi
if [[ -f /etc/redis.conf ]];then
    echo "|Redis 		: $(systemctl status redis.service | grep 'Active' | cut -f2 -d':' | xargs | cut -f1 -d' ' | xargs)                                                 |"
fi
if [[ -f /etc/csf/csf.conf ]];then
    echo "|CSF 		: $(systemctl status csf.service | grep 'Active' | cut -f2 -d':' | xargs | cut -f1 -d' ' | xargs)                                                 |"
fi
    echo "|SSH           : $(systemctl status sshd.service | grep 'Active' | cut -f2 -d':' | xargs | cut -f1 -d' ' | xargs)                                                 |"
    echo "|Crond         : $(systemctl status crond.service | grep 'Active' | cut -f2 -d':' | xargs | cut -f1 -d' ' | xargs)                                                 |"
    echo "|Fail2Ban      : $(systemctl status fail2ban.service | grep 'Active' | cut -f2 -d':' | xargs | cut -f1 -d' ' | xargs)                                                 |"
    echo "+-----------------------------------------------------------------------+"
}

function ip() {
    ip=$(curl -s myip.directadmin.com)
    if [[ "$ip" = "" ]]; then
        ip=$(curl -s ifconfig.me)
    fi
	if [[ $ip ]];then
    echo "IP hiện tại của webserver là: $ip"
else
	echoDo "Không xác định được địa chỉ IP"
	fi
}

function dns-check() {
    ip=$(curl -s myip.directadmin.com)
    if [[ "$ip" = "" ]]; then
        ip=$(curl -s ifconfig.me)
    fi
    NAME=$1
    if [ "$NAME" = "${NAME/./}" ]; then
        clear
        . /etc/wptt/.wptt.conf
        echo "Domain ten mien nhap khong dung dinh dang."
        echo "vi du nhu: $Website_chinh"
        exit
    fi

    checkdns=$(host $NAME | grep -Eo -m 1 '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}')
    if [[ "$checkdns" = "" ]]; then
        checkdns=$(nslookup $NAME | grep Address | cut -f5 | grep -Eo -m 1 '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}')
    fi

    if [[ "$checkdns" != "$ip" ]]; then
        echo "Ban chua tro ten mien dns ve webhost ip: $ip moi"
        echo "Hay tro dns thi moi co the cai duoc ssl"
        echo "Hay tro DNS $checkdns thanh $ip roi quay lai cai ssl nhe"
        if [[ "$checkdns" = "" ]]; then
            echo "Ten mien $NAME chua duoc tro IP gia tri IP cua $NAME la khong co gia tri nao, ban vui long tro IP ve $ip"
        fi
        echo "Ten mien $NAME dang duoc su dung quan ly boi $checknameserver ban hay truy cap vao do de tro ten mien cua minh"
    else
        echo "domain $NAME da tro dns ve may chu cua ban ($ip)"
    fi
}

function version() {
    . /etc/wptt/.wptt.conf
    RED='\033[0;31m'
    NC='\033[0m'
    wptangtocols_version=$(curl -s https://wptangtoc.com/share/version-wptangtoc-ols.txt)
    if [[ "$wptangtocols_version" != "$version_wptangtoc_ols" ]]; then
        clear
        echo "========================================================================="
        echo -e "Thông báo cập nhật - Bạn đang sử dụng WPTANGTOC OLS: ${RED} $version_wptangtoc_ols ${NC}"
        echo "-------------------------------------------------------------------------"
        echo -e "Đã có bản cập nhật mới WPTANGTOC OLS: ${RED} $wptangtocols_version ${NC}."
        echo "Gõ lệnh: 99 để cập nhật."
        echo "========================================================================="
    fi
}

function cauhinh() {
    . /etc/wptt/wptt-kiemtra
}

function cd() {
    bash /etc/wptt/ma-nguon/wptt-truy-cap-nhanh
}

function cdbk() {
    bash /etc/wptt/ma-nguon/wptt-truy-cap-nhanh-backup-website
}

function taikhoan() {
    . /etc/wptt/wptt-kiemtra2
}

function update-wptangtoc() {
    . /etc/wptt/wptt-update
}

function preload-all() {
    . /etc/wptt/wptt-preload-all
}

function preload() {
    NAME=$1
    if [ "$NAME" = "${NAME/./}" ]; then
        clear
        . /etc/wptt/.wptt.conf
        echoDo "Domain ten mien nhap khong dung dinh dang."
        echo "vi du nhu: $Website_chinh"
        exit
    fi
    bash /etc/wptt/wptt-preload-cache2 $NAME
}

function saoluu-all() {
    . /etc/wptt/backup-restore/wptt-backup-all
}


function zip() {
    . /etc/wptt/backup-restore/wptt-zip
}

function rm-login() {
pwd=$(pwd)
path_web=$(echo $pwd | cut -f1-6 -d '/')
_runing "Xóa WP cli login"
if [[ ! -d $path_web/wp-content/plugins/wp-cli-login-server ]];then
	_runloi "Xóa WP cli login"
	echoDo "website không cài đặt wp cli login"
	return 2>/dev/null;exit
fi
wp plugin deactivate wp-cli-login-server --path=$path_web --allow-root >/dev/null 2>&1 --skip-plugin=$(cat /etc/wptt/ioncube-plugin-list | tr  '\n' ',')
wp plugin delete wp-cli-login-server --path=$path_web --allow-root >/dev/null 2>&1 --skip-plugin=$(cat /etc/wptt/ioncube-plugin-list | tr  '\n' ',')
rm -rf $path_web/wp-content/plugins/wp-cli-login-server
tien_to=$(wp db prefix --allow-root --path=$path_web 2>/dev/null --skip-plugin=$(cat /etc/wptt/ioncube-plugin-list | tr  '\n' ','))
wp db query "DELETE FROM ${tien_to}options WHERE option_name = 'wp_cli_login'" --allow-root --path=$path_web 2>/dev/null
wp db query "UPDATE ${tien_to}options SET option_value = 'a:0:{}' WHERE option_name = 'recently_activated';" --path=$path_web --allow-root 2>/dev/null
_rundone "Xóa WP cli login"
}

function config-ls() {
pwd=$(pwd)
name_web=$(echo $pwd | cut -f5 -d '/')
if [[ $name_web = "" ]];then
	echoDo "Khong xac duoc duoc domain website"
	exit
fi
if [[ -d /usr/local/lsws/$name_web/html/wp-content/plugins/litespeed-cache ]];then
	wp litespeed-option set cache-browser false --allow-root --path=/usr/local/lsws/$name_web/html --skip-plugin=$(cat /etc/wptt/ioncube-plugin-list | tr  '\n' ','| sed 's/,$//g') >/dev/null 2>&1
	wp litespeed-option set cache-browser false --allow-root --path=/usr/local/lsws/$name_web/html >/dev/null 2>&1
/usr/local/lsws/bin/lswsctrl restart >/dev/null 2>&1
echo "Hoàn tất"
else
echo "Chưa cài đặt plugin litespeed cache"
fi
}


function login() {
pwd=$(pwd)
name_web=$(echo $pwd | cut -f5 -d '/')
if [[ $name_web = "" ]];then
	echoDo "Không xác định được domain website"
	exit
fi
. /etc/wptt/wordpress/login-wpadmin-magic $name_web
}

function login2() {
pwd=$(pwd)
name_web=$(echo $pwd | cut -f5 -d '/')
if [[ $name_web = "" ]];then
	echoDo "Khong xac duoc duoc domain website"
	exit
fi
. /etc/wptt/wordpress/login-wpadmin-magic-dologin $name_web
}


function rm-login2() {
pwd=$(pwd)
path_web=$(echo $pwd | cut -f1-6 -d '/')
_runing "Xóa WP dologin"
if [[ ! -d $path_web/wp-content/plugins/dologin ]];then
_runloi "Xóa WP dologin"
	echoDo "website không cài đặt wp dologin"
	return 2>/dev/null;exit
fi
wp plugin deactivate dologin --path=$path_web --allow-root >/dev/null 2>&1
wp plugin delete dologin --path=$path_web --allow-root >/dev/null 2>&1
rm -rf $path_web/wp-content/plugins/dologin
tien_to=$(wp db prefix --allow-root --path=$path_web 2>/dev/null)
WPMLTABLES=($(wp db tables --all-tables --allow-root --path=$path_web 2>/dev/null | grep '_dologin_'))
    for WPMLTABLE in ${WPMLTABLES[@]}; do
        wp db query "DROP TABLE ${WPMLTABLE}" --allow-root --path=$path_web 2>/dev/null
    done
 wp db query "DELETE FROM ${tien_to}options WHERE option_name LIKE 'dologin.%'" --allow-root --path=$path_web 2>/dev/null
_rundone "Xóa WP dologin"
}



function clear-cache() {
pwd=$(pwd)
name_web=$(echo $pwd | cut -f5 -d '/')
if [[ $name_web = "" ]];then
	echoDo "Không xác định được domain website"
	exit
fi
. /etc/wptt/cache/wptt-xoacache $name_web
}

function status() {
. /etc/wptt/wptt-status2 $name_web
}

function sitemap() {
pwd=$(pwd)
path_web=$(echo $pwd | cut -f1-6 -d '/')
_runing "Tạo lập sitemap"
if [[ ! -d $path_web ]];then
_runloi "Tạo lập sitemap"
return 2>/dev/null;exit
fi
if [[ ! -f $path_web/wp-load.php ]];then
_runloi "Tạo lập sitemap"
echoDo "website không sử dụng WordPress"
return 2>/dev/null;exit
fi
wp plugin install google-sitemap-generator --path=$path_web --allow-root --activate >/dev/null 2>&1
/usr/local/lsws/bin/lswsctrl restart >/dev/null 2>&1
_rundone "Tạo lập sitemap"
}

function query-monitor() {
pwd=$(pwd)
path_web=$(echo $pwd | cut -f1-6 -d '/')
_runing "Cài đặt plugin Query monitor"
if [[ ! -d $path_web ]];then
_runloi "Cài đặt plugin Query monitor"
return 2>/dev/null;exit
fi
if [[ ! -f $path_web/wp-load.php ]];then
_runloi "Cài đặt plugin Query monitor"
echoDo "website không sử dụng WordPress"
return 2>/dev/null;exit
fi
wp plugin install query-monitor --path=$path_web --allow-root --activate >/dev/null 2>&1
_rundone "Cài đặt plugin Query monitor"
}

function rm-query-monitor() {
pwd=$(pwd)
path_web=$(echo $pwd | cut -f1-6 -d '/')
_runing "Xóa plugin Query monitor"
if [[ ! -d $path_web ]];then
_runloi "Xóa plugin Query monitor"
return 2>/dev/null;exit
fi

if [[ ! -f $path_web/wp-load.php ]];then
_runloi "Xóa plugin Query monitor"
echoDo "website không sử dụng WordPress"
return 2>/dev/null;exit
fi

if [[ ! -d $path_web/wp-content/plugins/query-monitor ]];then
_runloi "Xóa plugin Query monitor"
echoDo "website không cài đặt query monitor"
return 2>/dev/null;exit
fi
wp plugin deactivate query-monitor --path=$path_web --allow-root >/dev/null 2>&1
wp plugin delete query-monitor --path=$path_web --allow-root >/dev/null 2>&1
_rundone "xóa plugin Query monitor"
}




function htaccess-chuyen-vhosts() {
pwd=$(pwd)
name_web=$(echo $pwd | cut -f5 -d '/')
if [[ $name_web = "" ]];then
	echoDo "Khong xac duoc duoc domain website"
	exit
fi
_runing "Chuyển .htaccess sang vhosts website $name_web"
. /etc/wptt/wptt-htaccess-tat-chuyen-doi-vhost $name_web >/dev/null 2>&1
_rundone "Chuyển .htaccess sang vhosts website $name_web"
}


function vhosts-chuyen-htaccess() {
pwd=$(pwd)
name_web=$(echo $pwd | cut -f5 -d '/')
if [[ $name_web = "" ]];then
	echoDo "Khong xac duoc duoc domain website"
	exit
fi
_runing "Chuyển vhosts sang .htaccess website $name_web"
. /etc/wptt/wptt-vhost-chuyen-ve-htaccess $name_web >/dev/null 2>&1
_rundone "Chuyển vhosts sang .htaccess website $name_web"
}


function list-domain() {
    . /etc/wptt/domain/wptt-list-domain
}

function saoluu() {
    NAME=$1
    if [ "$NAME" = "${NAME/./}" ]; then
        clear
        . /etc/wptt/.wptt.conf
        echoDo "Domain ten mien nhap khong dung dinh dang."
        echo "vi du nhu: $Website_chinh"
        sleep 3
        . /etc/wptt/backup-restore/wptt-saoluu
        exit
    fi
    . /etc/wptt/backup-restore/wptt-saoluu $NAME
}

function khoiphuc() {
    NAME=$1
    if [ "$NAME" = "${NAME/./}" ]; then
        clear
        . /etc/wptt/.wptt.conf
        echoDo "Domain ten mien nhap khong dung dinh dang."
        echo "vi du nhu: $Website_chinh"
        sleep 3
        . /etc/wptt/backup-restore/wptt-khoiphuc
        exit
    fi
    . /etc/wptt/backup-restore/wptt-khoiphuc $NAME
}

function xoa-cache-all() {
    . /etc/wptt/wordpress/xoa-cache-full
}

function xoa-cache() {
    NAME=$1
    if [ "$NAME" = "${NAME/./}" ]; then
        clear
        . /etc/wptt/.wptt.conf
        echo "Domain ten mien nhap khong dung dinh dang."
        echo "vi du nhu: $Website_chinh"
        exit
    fi
    . /etc/wptt/wordpress/wptt-xoacache $NAME
}

function phan-quyen() {
NAME=$1
if [[ $NAME ]];then
    if [ "$NAME" = "${NAME/./}" ]; then
        clear
        . /etc/wptt/.wptt.conf
        echo "Domain ten mien nhap khong dung dinh dang."
        echo "vi du nhu: $Website_chinh"
        exit
    fi
    . /etc/wptt/wptt-phan-quyen2 $NAME
else
    . /etc/wptt/wptt-phan-quyen-all
fi
}

function them-website() {
    NAME=$1
    if [ "$NAME" = "${NAME/./}" ]; then
        clear
        . /etc/wptt/.wptt.conf
        echo "Domain ten mien nhap khong dung dinh dang."
        echo "vi du nhu: $Website_chinh"
        exit
    fi
    . /etc/wptt/wptt-themwebsite $NAME
}


function ssl() {
    NAME=$1
    if [ "$NAME" = "${NAME/./}" ]; then
        clear
        . /etc/wptt/.wptt.conf
        echo "Domain ten mien nhap khong dung dinh dang."
        echo "vi du nhu: $Website_chinh"
        exit
    fi
    . /etc/wptt/ssl/wptt-caissl $NAME
}

function ssl-tra-phi-config() {
    NAME=$1
    if [ "$NAME" = "${NAME/./}" ]; then
        clear
        . /etc/wptt/.wptt.conf
        echo "Domain ten mien nhap khong dung dinh dang."
        echo "vi du nhu: $Website_chinh"
        exit
    fi
	if [[ ! -d /usr/local/lsws/$NAME/html ]];then
		echo "Domain không tồn tại trong hệ thống"
		exit
	fi
    bash /etc/wptt/ssl/wptt-config-ssl-tra-phi $NAME
}

function install-wordpress() {
    NAME=$1
    if [ "$NAME" = "${NAME/./}" ]; then
        clear
        . /etc/wptt/.wptt.conf
        echo "Domain tên miền nhập không đúng định dạng."
        echo "ví dụ như: $Website_chinh"
        exit
    fi
    . /etc/wptt/wptt-install-wordpress $NAME
}


function renew-ssl-free() {
_runing "Gia hạn SSl letsencrypt"
    /usr/bin/certbot renew --quiet
    /usr/local/lsws/bin/lswsctrl restart >/dev/null 2>&1
_rundone "Gia hạn SSl letsencrypt"
}

function htaccess-reset() {
    . /etc/wptt/wptt-htaccess-reset
}

function phpmyadmin() {
    . /etc/wptt/phpmyadmin/wptt-mo-phpmyadmin
}

function phpmyadmin-taikhoan() {
    . /etc/wptt/phpmyadmin/wptt-thongtin-phpmyadmin
}


function xoa-phpmyadmin() {
    . /etc/wptt/phpmyadmin/wptt-xoa-phpmyadmin
}


function wp-memcached(){
	if [[ -f /etc/sysconfig/memcached ]];then
		pwd=$(pwd)
		name_web=$(echo $pwd | cut -f5 -d '/')
		if [[ $name_web = "" ]];then
			echoDo "Không xác định được domain website"
			exit
		fi

		_runing "Thiết lập memcached"
		sed -i '/memcached_servers =/d' /usr/local/lsws/$name_web/html/wp-config.php 
		sed -i "2 i \$memcached_servers = ['/usr/local/lsws/memcached/memcached.sock:0'];" /usr/local/lsws/$name_web/html/wp-config.php
		rm -f /usr/local/lsws/"$name_web"/html/wp-content/object-cache.php
		cp -f /etc/wptt/cache/memcached.php /usr/local/lsws/$name_web/html/wp-content/object-cache.php
		. /etc/wptt/vhost/."$name_web".conf
		chown -R "$User_name_vhost":"$User_name_vhost" /usr/local/lsws/"$name_web"/html/wp-content/object-cache.php
		chmod 644 /usr/local/lsws/"$name_web"/html/wp-content/object-cache.php
		_rundone "Thiết lập memcached"
	fi
}


function wp-redis() {
if [[ -f /etc/redis.conf ]];then
pwd=$(pwd)
name_web=$(echo $pwd | cut -f5 -d '/')
if [[ $name_web = "" ]];then
	echoDo "Không xác định được domain website"
	exit
fi

if [[ ! -f /usr/local/lsws/$name_web/html/wp-config.php ]];then
echo "Không xác định được đây là website WordPress"
exit
fi

_runing "Kích hoạt redis cho website $NAME"
if [[ $(wp plugin list --fields=name --status=active --allow-root --path=$pwd | grep 'wp-redis') ]];then
	_runloi "Đã cài đặt wp redis trước đó rồi"
	echoDo "website không cài đặt wp redis trước đó rồi"
	return 2>/dev/null;exit
fi

sed -i '/redis_server =/d' /usr/local/lsws/$name_web/html/wp-config.php 
sed -i "2 i \$redis_server = array(\
    'host'=> '/var/run/redis/redis.sock',\
	'port'=>null,\
    'database'=> 0,\
);" /usr/local/lsws/$name_web/html/wp-config.php

wp plugin install wp-redis --activate --allow-root --path=/usr/local/lsws/$name_web/html
wp redis enable --allow-root --path=/usr/local/lsws/$name_web/html
_rundone "Kích hoạt redis cho website $NAME"
else
	echo "Chưa cài đặt redis trên hệ thống, vui lòng cài đặt redis"
fi
}


function disk() {
echo "==================================================================="
echo "Disk server: $(df -BG | awk '$NF=="/"{printf "%d/%dGB (%s)\n", $3,$2,$5}')"
echo "==================================================================="
	if [[ -d /usr/local/lsws/logs ]];then
kiemtra_dung_luong_logs_server=$(du -hs /usr/local/lsws/$domain/logs | sed 's/\t//g'| cut -f1 -d '/')
echo "Dung lượng logs của server là ${kiemtra_dung_luong_logs_server}B"
	fi

	if [[ -f /var/log/mysql/mysql.log ]]; then
		kiemtra_dung_luong_logs_server=$(du -hs /var/log/mysql | sed 's/\t//g'| cut -f1 -d '/')
		echo "Dung lượng logs database của server là ${kiemtra_dung_luong_logs_server}B"
	fi

if [ "$(ls -A /etc/wptt/vhost)" ]; then
  for entry in $(ls -A /etc/wptt/vhost); do
    domain=$(echo $entry | sed 's/^.//' | sed 's/.conf//')
    path="/usr/local/lsws/$domain/html"
    i=1
    if [[ -d "$path" ]]; then
echo "==================================================================="
echo "$domain đang sử dụng ổ cứng: "
kiemtra_dung_luong=$(du -hs $path | sed 's/\t//g'| cut -f1 -d '/')
echo "Dung lượng mã nguồn website $domain là ${kiemtra_dung_luong}B"
    fi
if [[ -d /usr/local/backup-website/$domain && $(ls /usr/local/backup-website/$domain | grep ".zip$\|.sql$\|.sql.gz$") ]];then
	kiemtra_dung_luong_backup=$(du -hs /usr/local/backup-website/$domain | sed 's/\t//g'| cut -f1 -d '/')
	echo "Dung lượng backup của website $domain là ${kiemtra_dung_luong_backup}B"
fi

	if [[ -d $path/wp-content/plugins/litespeed-cache && -d /usr/local/lsws/$domain/luucache ]];then
kiemtra_dung_luong_cache=$(du -hs /usr/local/lsws/$domain/luucache | sed 's/\t//g'| cut -f1 -d '/')
echo "Dung lượng cache LScache của website $domain là ${kiemtra_dung_luong_cache}B"
	fi

	if [[ -d /usr/local/lsws/$domain/logs ]];then
kiemtra_dung_luong_logs=$(du -hs /usr/local/lsws/$domain/logs | sed 's/\t//g'| cut -f1 -d '/')
echo "Dung lượng logs của website $domain là ${kiemtra_dung_luong_logs}B"
	fi

	. /etc/wptt/vhost/.$domain.conf
	if [[ -d /var/lib/mysql/$DB_Name_web ]];then
kiemtra_dung_luong_db=$(du -hs /var/lib/mysql/$DB_Name_web | sed 's/\t//g'| cut -f1 -d '/')
if [[ $(echo $kiemtra_dung_luong_db |grep 'K') = '' ]];then
	echo "Dung lượng database của website $domain là ${kiemtra_dung_luong_db}B"
fi
	fi
echo "==================================================================="
  done
fi
}

if [[ $2 ]];then
$1 $2
else
$1
fi

if [[ $1 = '' ]];then
help
fi

